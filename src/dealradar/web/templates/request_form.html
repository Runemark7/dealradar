{% extends "base.html" %}

{% block title %}Create Deal Request - DealRadar{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <div style="margin-bottom: 30px;">
        <a href="/requests" style="color: white; text-decoration: none; font-size: 0.9em;">‚Üê Back to Requests</a>
        <h2 style="color: white; margin: 15px 0 10px 0;">Create Deal Request</h2>
        <p style="color: rgba(255,255,255,0.9);">
            Tell us what you're looking for and we'll automatically search Blocket for perfect matches!
        </p>
    </div>

    <div style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <form id="request-form" hx-post="/api/requests" hx-target="#form-message" hx-indicator="#loading">

            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #333; font-weight: 600; margin-bottom: 8px;">
                    Request Title <span style="color: #EF4444;">*</span>
                </label>
                <input
                    type="text"
                    name="title"
                    required
                    maxlength="200"
                    placeholder="e.g., Hybrid Golf Club - 3 Hybrid"
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px;">
                <p style="color: #666; font-size: 0.85em; margin-top: 5px;">Give your request a clear, descriptive title</p>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #333; font-weight: 600; margin-bottom: 8px;">
                    Blocket Category <span style="color: #EF4444;">*</span>
                </label>
                <select
                    name="category"
                    required
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px;">
                    <option value="">Select a category...</option>
                    <option value="5021">Computers</option>
                    <option value="5020">Computer Accessories</option>
                    <option value="5040">Mobile Phones</option>
                    <option value="5060">Gaming Consoles</option>
                    <option value="5090">Sports & Outdoors</option>
                    <option value="5091">Golf Equipment</option>
                    <option value="40">Furniture & Home</option>
                    <option value="10">Vehicles</option>
                    <option value="80">Clothing & Fashion</option>
                    <option value="81">Men's Clothing</option>
                    <option value="82">Women's Clothing</option>
                    <option value="70">Music & Instruments</option>
                    <option value="60">Hobby & Collections</option>
                </select>
                <p style="color: #666; font-size: 0.85em; margin-top: 5px;">Which Blocket category should we search in?</p>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #333; font-weight: 600; margin-bottom: 8px;">
                    Maximum Budget (SEK)
                </label>
                <input
                    type="number"
                    name="max_budget"
                    min="0"
                    step="100"
                    placeholder="e.g., 1500"
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px;">
                <p style="color: #666; font-size: 0.85em; margin-top: 5px;">Optional: Leave empty for no budget limit</p>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #333; font-weight: 600; margin-bottom: 8px;">
                    What are you looking for? <span style="color: #EF4444;">*</span>
                </label>
                <textarea
                    name="requirements"
                    required
                    rows="6"
                    placeholder="Describe what you're looking for in detail. Include:&#10;- Specific features or specifications&#10;- Preferred condition&#10;- Location preferences&#10;- Any must-have requirements&#10;&#10;Example: Stiff flex, 3 hybrid or better, loft 18-20 degrees, located in Gothenburg"
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; font-family: inherit; resize: vertical;"></textarea>
                <p style="color: #666; font-size: 0.85em; margin-top: 5px;">Be specific! The AI will use this to evaluate matches.</p>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #333; font-weight: 600; margin-bottom: 8px;">
                    Your Email (to get notified) <span style="color: #EF4444;">*</span>
                </label>
                <input
                    type="email"
                    name="email"
                    required
                    placeholder="your.email@example.com"
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px;">
                <p style="color: #666; font-size: 0.85em; margin-top: 5px;">We'll email you when we find a perfect match</p>
            </div>

            <div style="background: #FEF3C7; border: 1px solid #FCD34D; border-radius: 8px; padding: 15px; margin-bottom: 25px;">
                <p style="color: #92400E; margin: 0; font-size: 0.9em;">
                    <strong>üìã Note:</strong> Your request will be reviewed and activated within 24 hours.
                    You'll be notified by email when it's approved and when matches are found.
                </p>
            </div>

            <div id="form-message" style="margin-bottom: 15px;"></div>

            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <a href="/requests" style="
                    padding: 12px 30px;
                    background: #E5E7EB;
                    color: #374151;
                    border-radius: 8px;
                    text-decoration: none;
                    font-weight: 600;
                    transition: background 0.3s;">
                    Cancel
                </a>
                <button
                    type="submit"
                    style="padding: 12px 30px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 15px; transition: background 0.3s;">
                    <span id="loading" class="htmx-indicator" style="display: none;">Submitting...</span>
                    <span id="submit-text">Create Request</span>
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    button:hover {
        background: #5568d3 !important;
    }
</style>

<script>
    document.body.addEventListener('htmx:afterRequest', function(event) {
        if (event.detail.successful) {
            // Show success message
            document.getElementById('form-message').innerHTML = `
                <div style="background: #D1FAE5; border: 1px solid #10B981; border-radius: 8px; padding: 15px; color: #065F46;">
                    <strong>‚úÖ Request created successfully!</strong><br>
                    Redirecting to requests page...
                </div>
            `;
            setTimeout(() => {
                window.location.href = '/requests';
            }, 2000);
        } else {
            // Show error message
            document.getElementById('form-message').innerHTML = `
                <div style="background: #FEE2E2; border: 1px solid #EF4444; border-radius: 8px; padding: 15px; color: #991B1B;">
                    <strong>‚ùå Error:</strong> ${event.detail.xhr.responseText || 'Failed to create request. Please try again.'}
                </div>
            `;
        }
    });
</script>
{% endblock %}
